# VLA Inference Node Configuration
# Robot-specific configuration is in crane_x7_robot.yaml

vla_inference_node:
  ros__parameters:
    # Model configuration
    # model_path is set via launch argument or VLA_MODEL_PATH environment variable
    model_base_name: 'openvla'  # Base model name ('openvla' or 'openvla-v01')

    # Task instruction
    task_instruction: 'pick up the object'  # Default task instruction

    # Model settings
    use_flash_attention: false  # Enable Flash Attention 2 (requires compatible GPU)
    device: 'cuda'  # Device: 'cuda' or 'cpu'
    # Unnormalization key for actions
    # For fine-tuned CRANE-X7 model: 'crane_x7'
    # For base OpenVLA model: 'bridge_orig' (default fallback)
    unnorm_key: 'crane_x7'

    # Topics
    image_topic: '/camera/color/image_raw'  # RGB image topic
    joint_states_topic: '/joint_states'  # Joint states topic
    action_topic: '/vla/predicted_action'  # Output action topic
    update_instruction_topic: '/vla/update_instruction'  # Instruction update topic

    # Inference settings
    inference_rate: 5.0  # Inference frequency (Hz) - reduced to prevent action cancellation
    center_crop: false  # Apply center crop to images (if trained with augmentation)

    # Pi0-specific settings (ignored for OpenVLA)
    chunk_use_count: 40  # Number of actions to use from each predicted chunk (increased to reduce chunk boundary oscillation)
    normalization_mode: 'quantile'  # Action normalization mode: 'quantile' or 'zscore' (must match training)

robot_controller:
  ros__parameters:
    # Topics
    action_topic: '/vla/predicted_action'  # VLA action input topic
    joint_states_topic: '/joint_states'  # Joint states topic

    # Execution settings
    execution_time: 0.15  # Time to execute each action (seconds) - shorter than inference period (0.2s)
    position_tolerance: 0.01  # Position tolerance for goal (radians)
    auto_execute: true  # Automatically execute received actions

    # NOTE: arm_joint_names and controller names are defined in crane_x7_robot.yaml
    # They can be overridden here if needed

initial_position_node:
  ros__parameters:
    # Execution settings
    execution_time: 3.0  # Time to reach initial position (seconds)
    position_tolerance: 0.05  # Position tolerance (radians)
    wait_for_joint_states: true  # Wait for joint states before moving

    # NOTE: initial positions and controller names are defined in crane_x7_robot.yaml
